openapi: 3.0.3
info:
  title: ONI AI Local API
  version: 1.1.0
  description: Local ONI-side API exposed by the C# mod for strict immediate operations and live snapshots.
servers:
  - url: /
paths:
  /health:
    get:
      summary: Health and speed-control availability
      responses:
        '200':
          description: Service available
          content:
            application/json:
              schema:
                type: object
                required: [ok, busy, current_speed, paused]
                properties:
                  ok:
                    type: boolean
                  busy:
                    type: boolean
                  current_speed:
                    type: integer
                    minimum: 1
                    maximum: 3
                  paused:
                    type: boolean
        '503':
          description: Speed control unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /speed:
    get:
      summary: Read current game speed and pause state
      responses:
        '200':
          description: Current speed state
          content:
            application/json:
              schema:
                type: object
                required: [speed, paused]
                properties:
                  speed:
                    type: integer
                    minimum: 1
                    maximum: 3
                  paused:
                    type: boolean
        '503':
          description: Speed control unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      summary: Set game speed
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [speed]
              additionalProperties: false
              properties:
                speed:
                  type: integer
                  enum: [1, 2, 3]
      responses:
        '200':
          description: Speed applied
          content:
            application/json:
              schema:
                type: object
                required: [status, speed, paused]
                properties:
                  status:
                    type: string
                    enum: [applied]
                  speed:
                    type: integer
                    minimum: 1
                    maximum: 3
                  paused:
                    type: boolean
        '400':
          description: Invalid JSON or invalid speed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /pause:
    get:
      summary: Read pause state
      responses:
        '200':
          description: Current pause state
          content:
            application/json:
              schema:
                type: object
                required: [paused, speed]
                properties:
                  paused:
                    type: boolean
                  speed:
                    type: integer
                    minimum: 1
                    maximum: 3
        '503':
          description: Speed control unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      summary: Pause or resume simulation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [paused]
              additionalProperties: false
              properties:
                paused:
                  type: boolean
      responses:
        '200':
          description: Pause state applied
          content:
            application/json:
              schema:
                type: object
                required: [status, paused, speed]
                properties:
                  status:
                    type: string
                    enum: [applied]
                  paused:
                    type: boolean
                  speed:
                    type: integer
                    minimum: 1
                    maximum: 3
        '400':
          description: Invalid JSON or missing paused
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


  /camera:
    get:
      summary: Read camera state and duplicant-based surrounding area hints
      responses:
        '200':
          description: Current camera state
          content:
            application/json:
              schema:
                type: object
                required: [x, y, z, world]
                properties:
                  x:
                    type: number
                  y:
                    type: number
                  z:
                    type: number
                  cell:
                    type: integer
                  orthographic_size:
                    type: number
                  focus_hint:
                    $ref: '#/components/schemas/GridPoint'
                  world:
                    type: object
                    additionalProperties: true
        '503':
          description: Camera unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      summary: Move camera to target x/y or center on duplicants
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: false
              properties:
                x:
                  type: number
                y:
                  type: number
                center_on_duplicants:
                  type: boolean
      responses:
        '200':
          description: Camera moved
          content:
            application/json:
              schema:
                type: object
                required: [status, x, y, z, world]
                properties:
                  status:
                    type: string
                    enum: [applied]
                  x:
                    type: number
                  y:
                    type: number
                  z:
                    type: number
                  world:
                    type: object
                    additionalProperties: true
        '400':
          description: Invalid JSON
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          description: Camera unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /build:
    post:
      summary: Apply build command immediately
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [building_id, points]
              additionalProperties: true
              properties:
                building_id:
                  type: string
                  minLength: 1
                points:
                  type: array
                  minItems: 1
                  items:
                    $ref: '#/components/schemas/GridPoint'
      responses:
        '200':
          description: Build command applied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppliedResponse'
        '400':
          description: Invalid JSON
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /dig:
    post:
      summary: Apply dig command immediately
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [points]
              additionalProperties: true
              properties:
                points:
                  type: array
                  minItems: 1
                  items:
                    $ref: '#/components/schemas/GridPoint'
      responses:
        '200':
          description: Dig command applied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppliedResponse'
        '400':
          description: Invalid JSON
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /deconstruct:
    post:
      summary: Apply deconstruct command immediately
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [points]
              additionalProperties: true
              properties:
                points:
                  type: array
                  minItems: 1
                  items:
                    $ref: '#/components/schemas/GridPoint'
      responses:
        '200':
          description: Deconstruct command applied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppliedResponse'
        '400':
          description: Invalid JSON
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /research:
    get:
      summary: Get research catalog from live game state
      responses:
        '200':
          description: Research catalog
          content:
            application/json:
              schema:
                type: object
                required: [current, available, potential, counts]
                properties:
                  current:
                    type: string
                  available:
                    type: array
                    items:
                      $ref: '#/components/schemas/ResearchItem'
                  potential:
                    type: array
                    items:
                      $ref: '#/components/schemas/ResearchItem'
                  counts:
                    type: object
                    required: [available, potential]
                    properties:
                      available:
                        type: integer
                      potential:
                        type: integer
        '503':
          description: Research catalog unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      summary: Set active research
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [tech_id]
              additionalProperties: false
              properties:
                tech_id:
                  type: string
                  minLength: 1
      responses:
        '200':
          description: Research applied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppliedResponse'
        '400':
          description: Invalid JSON
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /state:
    get:
      summary: Latest captured game state
      responses:
        '200':
          description: State snapshot
          content:
            application/json:
              schema:
                type: object
                required: [state, pending_action_count]
                properties:
                  state:
                    type: object
                    additionalProperties: true
                  pending_action_count:
                    type: integer
        '503':
          description: State snapshot unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /buildings:
    get:
      summary: Get building catalog from live game state
      responses:
        '200':
          description: Building catalog
          content:
            application/json:
              schema:
                type: object
                required: [available, potential, counts]
                properties:
                  available:
                    type: array
                    items:
                      $ref: '#/components/schemas/BuildingItem'
                  potential:
                    type: array
                    items:
                      $ref: '#/components/schemas/BuildingItem'
                  counts:
                    type: object
                    required: [available, potential]
                    properties:
                      available:
                        type: integer
                      potential:
                        type: integer
        '503':
          description: Building catalog unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /priorities:
    get:
      summary: Read live duplicant priorities
      responses:
        '200':
          description: Current priorities snapshot
          content:
            application/json:
              schema:
                type: object
                required: [priorities, source]
                properties:
                  priorities:
                    type: array
                    items:
                      type: object
                      additionalProperties: true
                  source:
                    type: string
                    enum: [game_live]
    post:
      summary: Apply duplicant priority updates
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [priorities]
              additionalProperties: false
              properties:
                priorities:
                  type: array
                  items:
                    type: object
                    required: [duplicant_id, values]
                    additionalProperties: false
                    properties:
                      duplicant_id:
                        type: string
                        minLength: 1
                      values:
                        type: object
                        additionalProperties:
                          type: integer
      responses:
        '200':
          description: Priority updates applied
          content:
            application/json:
              schema:
                type: object
                required: [accepted, status]
                properties:
                  accepted:
                    type: integer
                  status:
                    type: string
                    enum: [applied]
        '400':
          description: Invalid JSON or invalid priorities payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    GridPoint:
      type: object
      required: [x, y]
      additionalProperties: false
      properties:
        x:
          type: integer
        y:
          type: integer

    ErrorResponse:
      type: object
      required: [error]
      properties:
        error:
          type: string

    AppliedResponse:
      type: object
      required: [status, message]
      properties:
        status:
          type: string
          enum: [applied]
        message:
          type: string

    BuildingItem:
      type: object
      required: [id, name, category]
      properties:
        id:
          type: string
        name:
          type: string
        category:
          type: string

    ResearchItem:
      type: object
      required: [id, name, tier]
      properties:
        id:
          type: string
        name:
          type: string
        tier:
          type: string
